---
// MGrid.astro
import Layout from '../layouts/Layout.astro';
import Patch from '../components/Patch.astro';
import MTile from '../components/MTile.astro';
import { getCollection } from 'astro:content';
const testimonials = await getCollection('testimonials');
const desktopGrid = [
    { color: 'var(--color-moonstone)', rowStart: 1, colStart: 1, width: 8, height: 7 },
    { color: 'var(--color-bittersweet)', colStart: 9, rowStart: 1, width: 9, height: 7 },
    { color: 'var(--color-asparagus)', colStart: 18, rowStart: 1, width: 7, height: 7 },
    { color: 'var(--color-wine)', colStart: 25, rowStart: 1, width: 7, height: 9 },
    { color: 'var(--color-asparagus)', colStart: 1, rowStart: 8, width: 9, height: 7 },
    { color: 'var(--color-moonstone)', colStart: 10, rowStart: 8, width: 8, height: 8 },
    { color: 'var(--color-bittersweet)', colStart: 18, rowStart: 8, width: 7, height: 7 },
    { color: 'var(--color-moonstone)', colStart: 25, rowStart: 10, width: 7, height: 7 },
    { color: 'var(--color-bittersweet)', colStart: 1, rowStart: 15, width: 9, height: 9 },
    { color: 'var(--color-asparagus)', colStart: 10, rowStart: 16, width: 8, height: 8 },
    { color: 'var(--color-wine)', colStart: 18, rowStart: 15, width: 7, height: 9 },
    { color: 'var(--color-asparagus)', colStart: 25, rowStart: 17, width: 7, height: 7 }
];

// Calculate spacing based on number of testimonials
const numTestimonials = Math.min(testimonials.length, 5); // Max 5 testimonials
const N = Math.ceil(desktopGrid.length / (numTestimonials + 1)); // Space them evenly

// Create array to track what goes in each tile
const gridItems = Array(desktopGrid.length).fill(null);

// Place testimonials first
let testimonialIndex = 0;
for (let i = 0; i < desktopGrid.length && testimonialIndex < numTestimonials; i += N) {
    gridItems[i] = testimonials[testimonialIndex];
    testimonialIndex++;
}
---

<Layout title="Mondrian Grid">
    <div
        class="grid-container"
        style="display: grid; grid-template-columns: repeat(31, 1fr); grid-auto-rows: 1fr; width: 100%; max-width: 1200px; margin: 5rem auto;"
    >
        {
            desktopGrid.map((tile) => (
                <MTile {...tile}>
                    <Patch author="TestimonialCard" color="var(--color-wine)" />
                </MTile>
            ))
        }
    </div>
</Layout>
